<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Flowchart Puzzle Game</title>
  <link rel="stylesheet" href="../css/minigame.css">
  <link rel="stylesheet" href="../css/style.css">
  <link rel="stylesheet" href="../css/logical.css">

  <script src="../src/logical_game.js" type="module"></script>

  <!-- Monospace for coding vibe + modern sans for headings -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@600;800&family=Source+Code+Pro:wght@400;600&display=swap" rel="stylesheet" />
  <!-- Header / brand -->
  <header class="brandbar" role="banner">
      <h1>CAMT OPEN HOUSE 68<span class="cursor">_</span></h1>
      <div><h2>Flowchart Puzzle Game!!!<span class="cursor">_</span></h2></div>
  </header>
  <style>
    .block[data-type="start"] { background: #2196f3; }
    .block[data-type="end"] { background: #9c27b0; }
    .dropzone { min-width: 400px; justify-content: flex-start; }
    #result { margin-top: 15px; font-size: 18px; font-weight: bold; }
    #level { margin: 10px; font-size: 20px; font-weight: bold; }
  </style>
</head>
<body>
  <main id="content">

    <div id="result" class="result_logic"></div>

    <div class="section-row">
      <section class="minigameUI_card" aria-labelledby="Pototype-card">
        <div id="level">Level 1</div>
        <p id="objective">Objective: Make the robot walk and then stop.</p>
        <div class="blocks" id="blocks"></div>
      </section>
    
      <section class="minigameUI_card" aria-labelledby="Pototype-card">
        <div class="dropzone" id="dropzone">‡∏ß‡∏≤‡∏á‡∏ö‡∏•‡πá‡∏≠‡∏Å‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà ‚û°Ô∏è</div>
      </section>
    </div>
    <div>
      <button class="btn_submitgame" onclick="checkAnswer()">‚úÖ ‡∏ï‡∏£‡∏ß‡∏à‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö</button>
      <button class="btn_clear" onclick="clearBlocks()">üóëÔ∏è ‡πÄ‡∏Ñ‡∏•‡∏µ‡∏¢‡∏£‡πå‡∏ö‡∏•‡πá‡∏≠‡∏Å</button>
    </div>
  </main>
</body>
  <script>
    const levels = [
      { 
        objective: "Make the robot walk and then stop.",
        blocks: ["start", "walk", "end"],
        correct: ["start","walk","end"]
      },
      { 
        objective: "Make the robot walk, then jump, then stop.",
        blocks: ["start", "walk", "jump", "end"],
        correct: ["start","walk","jump","end"]
      },
      { 
        objective: "Make the robot pick an item, walk, jump, then stop.",
        blocks: ["start", "pick", "walk", "jump", "end"],
        correct: ["start","pick","walk","jump","end"]
      },
      { 
        objective: "Make the robot walk twice, then stop.",
        blocks: ["start", "walk", "walk", "end"],
        correct: ["start","walk","walk","end"]
      },
      { 
        objective: "Make the robot jump, pick an item, walk, then stop.",
        blocks: ["start", "jump", "pick", "walk", "end"],
        correct: ["start","jump","pick","walk","end"]
      },
      { 
        objective: "Final: Make the robot pick, walk, jump, walk, then stop.",
        blocks: ["start", "pick", "walk", "jump", "walk", "end"],
        correct: ["start","pick","walk","jump","walk","end"]
      }
    ];

    let currentLevel = 0;

    // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏∏‡πà‡∏°‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏ö‡∏•‡πá‡∏≠‡∏Å
    function shuffleBlocks(blocks) {
      for (let i = blocks.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [blocks[i], blocks[j]] = [blocks[j], blocks[i]];
      }
      return blocks;
    }

    function loadLevel(levelIndex) {
      const level = levels[levelIndex];
      document.getElementById("level").innerText = "Level " + (levelIndex + 1);
      document.getElementById("objective").innerText = "Objective: " + level.objective;

      const blocksContainer = document.getElementById("blocks");
      blocksContainer.innerHTML = "";

      // ‡∏™‡∏∏‡πà‡∏°‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏ö‡∏•‡πá‡∏≠‡∏Å‡∏Å‡πà‡∏≠‡∏ô‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•
      const shuffledBlocks = shuffleBlocks([...level.blocks]);

      shuffledBlocks.forEach(b => {
        const block = document.createElement("div");
        block.className = "block";
        block.innerText = b.charAt(0).toUpperCase() + b.slice(1);
        block.dataset.type = b;
        block.draggable = true;

        block.addEventListener("dragstart", e => {
          e.dataTransfer.setData("type", block.dataset.type);
          e.dataTransfer.setData("text", block.innerText);
        });

        blocksContainer.appendChild(block);
      });

      document.getElementById("dropzone").innerHTML = "‡∏ß‡∏≤‡∏á‡∏ö‡∏•‡πá‡∏≠‡∏Å‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà ‚û°Ô∏è";
      document.getElementById("result").innerText = "";
    }

    const dropzone = document.getElementById('dropzone');
    dropzone.addEventListener('dragover', e => e.preventDefault());
    dropzone.addEventListener('drop', e => {
      e.preventDefault();
      const type = e.dataTransfer.getData('type');
      const text = e.dataTransfer.getData('text');
      const newBlock = document.createElement('div');
      newBlock.className = 'block';
      newBlock.dataset.type = type;
      newBlock.innerText = text;
      dropzone.appendChild(newBlock);
    });

    function checkAnswer() {
      const placed = [...dropzone.querySelectorAll('.block')].map(b => b.dataset.type);
      const correct = levels[currentLevel].correct;
      const result = document.getElementById('result');

      if (JSON.stringify(placed) === JSON.stringify(correct)) {
        result.innerText = "üéâ Correct! Moving to next level...";
        result.style.color = "green";
        setTimeout(() => {
          currentLevel++;
          if (currentLevel < levels.length) {
            loadLevel(currentLevel);
          } else {
            result.innerText = "üèÜ Congratulations! You finished all 6 puzzles!";
          }
        }, 1500);
      } else {
        result.innerText = "‚ùå Wrong sequence, try again!";
        result.style.color = "red";
      }
    }

    // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÄ‡∏Ñ‡∏•‡∏µ‡∏¢‡∏£‡πå‡∏ö‡∏•‡πá‡∏≠‡∏Å‡πÉ‡∏ô dropzone
    function clearBlocks() {
      const dropzone = document.getElementById("dropzone");
      if (dropzone) {
        dropzone.innerHTML = "‡∏ß‡∏≤‡∏á‡∏ö‡∏•‡πá‡∏≠‡∏Å‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà ‚û°Ô∏è";
      }
    }

    // ‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏•‡πÄ‡∏ß‡∏•‡πÅ‡∏£‡∏Å
    loadLevel(currentLevel);
  </script>
</body>
</html>
